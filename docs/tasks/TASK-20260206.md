# Task: Implement Development Platform

| Status | Created | Updated |
|--------|---------|---------|
| In Progress | 2026-02-06 | 2026-02-07 |

## Objective

Stand up Forgejo as the local development hub, replacing the file-based task system with issue-based task management and providing git hosting, pull request workflow, and CI/CD via Forgejo Actions.

## References

- [ADR-DEV-DEVPLATFORM-20260206](../adrs/ADR-DEV-DEVPLATFORM-20260206.md)

## Scope

### In Scope

- Add Forgejo service to Docker Compose, configured to use the shared PostgreSQL instance (`forgejo` database)
- Add Forgejo Actions runner service to Docker Compose with Docker socket access
- Configure Forgejo (admin account, shared service account, API token)
- Create the Skiploom repository in Forgejo and push the existing codebase
- Configure branch protection rules on `main`
- Define Forgejo Actions workflow for running tests on pull requests
- Define issue labels for task workflow (`in-progress`, `blocked`, and any others needed)
- Migrate existing tasks from `docs/tasks/` to Forgejo issues
- Document agent interaction patterns (API calls for issue management, branch naming, PR creation)

### Out of Scope

- Per-agent Forgejo accounts
- Project board configuration (can be added later per ADR)
- Forgejo wiki setup
- Backup/restore automation for Forgejo data
- Removing the file-based task system from the repository (separate cleanup task)

## Acceptance Criteria

- [ ] `docker compose up` starts Forgejo, PostgreSQL, and the Actions runner
- [ ] Forgejo web UI is accessible on port 3000
- [ ] Skiploom repository is hosted in Forgejo with full commit history
- [ ] Shared service account exists with an API token
- [ ] Agents can create, query, assign, comment on, and close issues via the REST API
- [ ] Agents can push branches and open pull requests via git + API
- [ ] Forgejo Actions runs the test suite on pull requests
- [ ] Existing tasks from `docs/tasks/` are represented as Forgejo issues

## Implementation Notes

- Forgejo uses a dedicated `forgejo` database on the shared PostgreSQL instance. The `postgres` service may need an init script to create both `skiploom` and `forgejo` databases on first startup.
- The runner must register with the Forgejo instance before it can pick up jobs. This may require a registration token generated during Forgejo setup. Consider an entrypoint script or init container to handle registration automatically.
- The Actions workflow should mirror the project's TDD convention: run the full test suite and fail the PR if any test fails.
- SSH access on port 2222 is optional; HTTP clone via port 3000 is sufficient for agent workflows.

## Progress Log

- 2026-02-07 Docker Compose with Forgejo, PostgreSQL, and Actions runner operational
- 2026-02-07 Setup script creates admin, service account, API token, repo, branch protection, labels
- 2026-02-07 CI workflow defined for backend and frontend tests on PRs
- 2026-02-07 Existing tasks migrated to Forgejo issues
- 2026-02-07 Agent interaction patterns documented
